---
title: "DataAnalysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(stringr)
library(readr)
library(dplyr)
library(corrplot)
library(car)
library(lattice)
library(caret)
library(readr)
library(tidyverse)
library(janitor)
library(lubridate)

FullClimateData <- read_csv("FullclimateData.csv")
FullClimateData <- clean_names(FullClimateData)


View(FullClimateData)



FullClimateData$month_year_collected <- as.Date(FullClimateData$month_year_collected, format = "%m/%d/%Y")



```

```{r}
#finding distinct colleges in dataset
#unique(climateData[c("college_name")])

#creating excel file
# library("xlsx")
# write.xlsx(unique(FullclimateData[c("college_name")]), file = "uniquecolleges.xlsx", sheetName = "UNIQUE COLLEGES", append = FALSE)
```

```{r}
#distinct colleges in dataset
library("xlsx")
write.xlsx(unique(FullClimateData[c("college_name")]), file = "uniquecolleges.xlsx", sheetName = "uniqueColleges", append = FALSE)

```

```{r}
#partitioning columns
FullClimateData$wind <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Wind',x))))
FullClimateData$solar <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Solar',x))))
FullClimateData$Biomas <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Biomas',x))))
FullClimateData$Biogas <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Biogas',x))))
FullClimateData$SmallHydro <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Small-hydro',x))))
FullClimateData$Geothermal <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Geothermal',x))))
FullClimateData$Various <- apply(FullClimateData, 1, function(x)as.integer(any(grep('Various',x))))


```


```{r}
#map of rank for the top 30 in July 2021
climate <- st_as_sf(FullClimateData, coords = c("long", "lat"),  crs = 4326)
mapview(
  climate, 
  map.types = "Stamen.TonerLite", 
  popup = TRUE, 
  zcol = "rank", 
  at = c(1, 5, 10, 15, 20, 25, 30)
  )   %>% 
  addStaticLabels(label = FullClimateData$college_name,
                  noHide = T,
                  direction = 'top',
                  textOnly = TRUE,
  )
     
```

```{r}
top5 <- filter(FullClimateData, college_name == "University of California" | college_name =="Arizona State University" | college_name == "Columbia University" | college_name =="University at Buffalo, The State University of New York" | college_name== "Boston University")

top10 <- filter(FullClimateData, college_name == "Stanford University" | college_name =="University of Maryland" | college_name == "Georgetown University" | college_name =="University of Utah" | college_name== "Carnegie Mellon University")

top15 <- filter(FullClimateData, college_name == "Saint Louis University" | college_name =="University of Oklahoma" | college_name == "Northeastern University" | college_name =="Northwestern University" | college_name== "The Ohio State University")

top20 <- filter(FullClimateData, college_name == "Saint Louis University" | college_name =="University of Oklahoma" | college_name == "Northeastern University" | college_name =="Northwestern University" | college_name== "The Ohio State University")

ggplot(top5, aes(x = factor(month_year_collected), y = rank, colour = college_name, group = college_name))+
  geom_line() +labs(title = "Top 5 Colleges in July 2021 and their Ranks Over Time", x = "Month and Year", y = "Rank") + theme(axis.text.x = element_text(angle = 270))

ggplot(top10, aes(x = factor(month_year_collected), y = rank, colour = college_name, group = college_name))+
  geom_line() +labs(title = "Colleges ranked 6-10 in July 2021 and their Ranks Over Time", x = "Month and Year", y = "Rank") + theme(axis.text.x = element_text(angle = 270))

ggplot(top15, aes(x = factor(month_year_collected), y = rank, colour = college_name, group = college_name))+
  geom_line() +labs(title = "Colleges ranked 11-15 in July 2021 and their Ranks Over Time", x = "Month and Year", y = "Rank") + theme(axis.text.x = element_text(angle = 270))

```

```{r}


#scatterplots between two variables

#hours of sunlight / city
qplot(x = hours_of_sunlight_per_city, y = city_location_of_institution, data = FullClimateData)

#annual green power usage / average enrollment
qplot(x = annual_green_power_usage_k_wh, y = average_enrollment_from_2020_2018, data = FullClimateData)
```


```{r}
#correlation tests

#rank / average enrollment
cor.test(FullClimateData$rank, FullClimateData$average_enrollment_from_2020_2018, method = 'spearman')

#annual green power usage / average enrollment
cor.test(FullClimateData$annual_green_power_usage_k_wh, FullClimateData$average_enrollment_from_2020_2018, method = 'spearman')

#annual green power usage / rank
cor.test(FullClimateData$annual_green_power_usage_k_wh, FullClimateData$rank, method = 'spearman')

ClimateTest <- lm(rank ~ hours_of_sunlight_per_city + average_enrollment_from_2020_2018 + annual_green_power_usage_k_wh + wind + solar + Biomass + Various, data = FullClimateData)
summary(ClimateTest)

```

```{r}
ggplot(top5, aes(x = factor(month_year_collected), y = rank, colour = college_name, group = college_name))+
  geom_line() +labs(title = "Top 5 Colleges in July 2021 and their Ranks Over Time", x = "Month and Year", y = "Rank") + theme(axis.text.x = element_text(angle = 270))
```

